<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTS - Sistema de Gestión Avanzado</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="/css/styles.css" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" as="style">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
    
    <!-- Meta tags for SEO and PWA -->
    <meta name="description" content="Sistema de gestión de ventas profesional para agencias de viajes">
    <meta name="theme-color" content="#1a365d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="NTS Sistema">
</head>
<body>
    <!-- Loading Screen -->
    <div id="app-loader" class="app-loader">
        <div class="loader-content">
            <div class="loader-logo">
                <img src="/images/nts-logo.png" alt="NTS" class="loader-logo-img">
            </div>
            <div class="loader-spinner"></div>
            <div class="loader-text">Iniciando NTS Sistema...</div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header mejorado -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-brand">
                    <img src="/images/nts-logo.png" alt="NTS Logo" class="brand-logo">
                    <div class="brand-info">
                        <h1 class="brand-title">NTS</h1>
                        <p class="brand-subtitle">NIEVA TRAVEL SERVICES</p>
                    </div>
                </div>
                
                <div class="header-actions">
                    <div class="user-info">
                        <div class="user-avatar">
                            <span class="user-initial">U</span>
                        </div>
                        <div class="user-details">
                            <span class="user-name">Usuario</span>
                            <span class="user-role">Administrador</span>
                        </div>
                    </div>
                    
                    <div class="header-controls">
                        <button class="btn-icon" id="notifications-btn" title="Notificaciones">
                            <i data-lucide="bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                        <button class="btn-icon" id="settings-btn" title="Configuración">
                            <i data-lucide="settings"></i>
                        </button>
                        <button class="btn-icon" id="fullscreen-btn" title="Pantalla completa">
                            <i data-lucide="maximize"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar Navigation -->
        <aside class="app-sidebar" id="app-sidebar">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3 class="nav-section-title">Principal</h3>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <button class="nav-link active" data-tab="dashboard">
                                <i data-lucide="layout-dashboard"></i>
                                <span>Dashboard</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-tab="nueva-venta">
                                <i data-lucide="plus-circle"></i>
                                <span>Nueva Venta</span>
                            </button>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3 class="nav-section-title">Gestión</h3>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <button class="nav-link" data-tab="ventas">
                                <i data-lucide="shopping-cart"></i>
                                <span>Ventas</span>
                                <span class="nav-badge">12</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-tab="clientes">
                                <i data-lucide="users"></i>
                                <span>Clientes</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-tab="proveedores">
                                <i data-lucide="building"></i>
                                <span>Proveedores</span>
                            </button>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3 class="nav-section-title">Análisis</h3>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <button class="nav-link" data-tab="reportes">
                                <i data-lucide="bar-chart-3"></i>
                                <span>Reportes</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-tab="analytics">
                                <i data-lucide="trending-up"></i>
                                <span>Analytics</span>
                            </button>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="connection-status" id="connection-status">
                    <div class="status-indicator online"></div>
                    <span class="status-text">Conectado</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Dashboard -->
            <section id="dashboard" class="tab-content active">
                <div class="page-header">
                    <div class="page-title">
                        <h2>Dashboard</h2>
                        <p>Resumen general del sistema</p>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-secondary" id="refresh-dashboard">
                            <i data-lucide="refresh-cw"></i>
                            Actualizar
                        </button>
                        <button class="btn btn-primary" data-tab="nueva-venta">
                            <i data-lucide="plus"></i>
                            Nueva Venta
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-icon">
                            <i data-lucide="dollar-sign"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="ventas-mes">$0</div>
                            <div class="stat-label">Ventas del Mes</div>
                            <div class="stat-change positive">
                                <i data-lucide="trending-up"></i>
                                +12.5%
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card success">
                        <div class="stat-icon">
                            <i data-lucide="shopping-bag"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="ventas-total">0</div>
                            <div class="stat-label">Total Ventas</div>
                            <div class="stat-change positive">
                                <i data-lucide="trending-up"></i>
                                +8.2%
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card warning">
                        <div class="stat-icon">
                            <i data-lucide="clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="pendientes">0</div>
                            <div class="stat-label">Pendientes</div>
                            <div class="stat-change negative">
                                <i data-lucide="trending-down"></i>
                                -3.1%
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card info">
                        <div class="stat-icon">
                            <i data-lucide="users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-clientes">0</div>
                            <div class="stat-label">Clientes</div>
                            <div class="stat-change positive">
                                <i data-lucide="trending-up"></i>
                                +5.7%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts and Recent Activity -->
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Ventas por Mes</h3>
                            <div class="card-actions">
                                <button class="btn-icon" title="Más opciones">
                                    <i data-lucide="more-horizontal"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <canvas id="sales-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Actividad Reciente</h3>
                            <div class="card-actions">
                                <button class="btn-text" data-tab="ventas">Ver todas</button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div id="recent-activity" class="activity-list">
                                <!-- Actividad reciente se carga dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Nueva Venta -->
            <section id="nueva-venta" class="tab-content">
                <div class="page-header">
                    <div class="page-title">
                        <h2>Nueva Venta</h2>
                        <p>Crear una nueva venta de viaje</p>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-secondary" id="save-draft">
                            <i data-lucide="save"></i>
                            Guardar Borrador
                        </button>
                        <button class="btn btn-primary" id="create-sale">
                            <i data-lucide="check"></i>
                            Crear Venta
                        </button>
                    </div>
                </div>

                <div class="form-container">
                    <!-- Progress Steps -->
                    <div class="progress-steps">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">Cliente</div>
                        </div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">Viaje</div>
                        </div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">Servicios</div>
                        </div>
                        <div class="step" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-label">Resumen</div>
                        </div>
                    </div>

                    <!-- Step 1: Cliente -->
                    <div class="form-step active" data-step="1">
                        <div class="form-card">
                            <div class="card-header">
                                <h3>
                                    <i data-lucide="user"></i>
                                    Información del Cliente
                                </h3>
                            </div>
                            <div class="card-content">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="cliente-nombre">Nombre Completo *</label>
                                        <input type="text" id="cliente-nombre" class="form-control" placeholder="Ingrese el nombre completo" required>
                                        <div class="form-help">Escriba para buscar clientes existentes</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="cliente-email">Email</label>
                                        <input type="email" id="cliente-email" class="form-control" placeholder="cliente@email.com">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="cliente-telefono">Teléfono</label>
                                        <input type="tel" id="cliente-telefono" class="form-control" placeholder="+54 9 11 1234-5678">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="cliente-doc-tipo">Tipo de Documento</label>
                                        <select id="cliente-doc-tipo" class="form-control">
                                            <option value="dni">DNI</option>
                                            <option value="pasaporte">Pasaporte</option>
                                        </select>
                                    </div>

                                    <div class="form-group" id="grupo-dni">
                                        <label for="cliente-dni">DNI</label>
                                        <input type="text" id="cliente-dni" class="form-control" placeholder="12345678">
                                    </div>

                                    <div class="form-group" id="grupo-dni-exp">
                                        <label for="cliente-dni-expiracion">Vencimiento DNI</label>
                                        <input type="date" id="cliente-dni-expiracion" class="form-control">
                                    </div>

                                    <div class="form-group hidden" id="grupo-pasaporte">
                                        <label for="cliente-pasaporte">Pasaporte</label>
                                        <input type="text" id="cliente-pasaporte" class="form-control" placeholder="AB123456">
                                    </div>

                                    <div class="form-group hidden" id="grupo-pasaporte-exp">
                                        <label for="cliente-pasaporte-expiracion">Vencimiento Pasaporte</label>
                                        <input type="date" id="cliente-pasaporte-expiracion" class="form-control">
                                    </div>

                                    <div class="form-group">
                                        <label for="vendedor-select-nts"><strong>Vendedor Responsable *</strong></label>
                                        <select id="vendedor-select-nts" class="form-control" required>
                                            <option value="">Seleccionar vendedor...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Viaje -->
                    <div class="form-step" data-step="2">
                        <div class="form-card">
                            <div class="card-header">
                                <h3>
                                    <i data-lucide="map-pin"></i>
                                    Información del Viaje
                                </h3>
                            </div>
                            <div class="card-content">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="fecha-venta">Fecha de Venta *</label>
                                        <input type="date" id="fecha-venta" class="form-control" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="fecha-viaje-inicio">Fecha de Inicio *</label>
                                        <input type="date" id="fecha-viaje-inicio" class="form-control" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="fecha-viaje-fin">Fecha de Fin</label>
                                        <input type="date" id="fecha-viaje-fin" class="form-control">
                                    </div>

                                    <div class="form-group full-width">
                                        <label for="observaciones-venta">Observaciones del Viaje</label>
                                        <textarea id="observaciones-venta" class="form-control" rows="4" placeholder="Detalles especiales, notas importantes, comentarios del cliente..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Servicios -->
                    <div class="form-step" data-step="3">
                        <div class="services-container">
                            <div class="services-tabs">
                                <button class="service-tab active" data-service="vuelo">
                                    <i data-lucide="plane"></i>
                                    Vuelos
                                </button>
                                <button class="service-tab" data-service="hotel">
                                    <i data-lucide="building"></i>
                                    Hoteles
                                </button>
                                <button class="service-tab" data-service="traslado">
                                    <i data-lucide="car"></i>
                                    Traslados
                                </button>
                                <button class="service-tab" data-service="excursion">
                                    <i data-lucide="map"></i>
                                    Excursiones
                                </button>
                            </div>

                            <!-- Service Forms -->
                            <div id="service-forms">
                                <!-- Los formularios de servicios se cargan dinámicamente -->
                            </div>

                            <!-- Added Services -->
                            <div class="added-services">
                                <div class="card-header">
                                    <h3>
                                        <i data-lucide="list"></i>
                                        Servicios Agregados
                                    </h3>
                                </div>
                                <div id="services-list" class="services-list">
                                    <div class="empty-state">
                                        <i data-lucide="package"></i>
                                        <p>No hay servicios agregados</p>
                                        <small>Agregue servicios usando las pestañas de arriba</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Resumen -->
                    <div class="form-step" data-step="4">
                        <div class="summary-container">
                            <div class="summary-card">
                                <div class="card-header">
                                    <h3>
                                        <i data-lucide="file-text"></i>
                                        Resumen de la Venta
                                    </h3>
                                </div>
                                <div class="card-content">
                                    <div id="sale-summary">
                                        <!-- Resumen se genera dinámicamente -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="total-card">
                                <div class="total-breakdown">
                                    <div class="total-row">
                                        <span>Subtotal:</span>
                                        <span id="subtotal">$0</span>
                                    </div>
                                    <div class="total-row">
                                        <span>Descuentos:</span>
                                        <span id="descuentos">$0</span>
                                    </div>
                                    <div class="total-row total-final">
                                        <span>Total Final:</span>
                                        <span id="total-final">$0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="form-navigation">
                        <button class="btn btn-secondary" id="prev-step" style="display: none;">
                            <i data-lucide="chevron-left"></i>
                            Anterior
                        </button>
                        <button class="btn btn-primary" id="next-step">
                            Siguiente
                            <i data-lucide="chevron-right"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Otras secciones (placeholder) -->
            <section id="ventas" class="tab-content">
                <div class="page-header">
                    <div class="page-title">
                        <h2>Gestión de Ventas</h2>
                        <p>Administrar todas las ventas</p>
                    </div>
                </div>
                <div class="table-actions">
                    <input type="text" id="ventas-search" class="form-control" placeholder="Buscar ventas...">
                    <select id="ventas-filter" class="form-control">
                        <option value="">Todos los estados</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="confirmada">Confirmada</option>
                        <option value="cancelada">Cancelada</option>
                        <option value="finalizada">Finalizada</option>
                    </select>
                </div>
                <div class="table-container">
                    <table id="ventas-table" class="table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Cliente</th>
                                <th>Fecha</th>
                                <th>Total</th>
                                <th>Estado</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="clientes" class="tab-content">
                <div class="page-header">
                    <div class="page-title">
                        <h2>Gestión de Clientes</h2>
                        <p>Administrar base de clientes</p>
                    </div>
                </div>
                <div class="coming-soon">
                    <i data-lucide="construction"></i>
                    <h3>Próximamente</h3>
                    <p>Esta sección está en desarrollo</p>
                </div>
            </section>

            <section id="proveedores" class="tab-content">
                <div class="page-header">
                    <div class="page-title">
                        <h2>Gestión de Proveedores</h2>
                        <p>Administrar proveedores de servicios</p>
                    </div>
                </div>
                <div class="coming-soon">
                    <i data-lucide="construction"></i>
                    <h3>Próximamente</h3>
                    <p>Esta sección está en desarrollo</p>
                </div>
            </section>

            <section id="reportes" class="tab-content">
                <div class="page-header">
                    <div class="page-title">
                        <h2>Reportes</h2>
                        <p>Análisis y reportes del sistema</p>
                    </div>
                </div>
                <div class="coming-soon">
                    <i data-lucide="construction"></i>
                    <h3>Próximamente</h3>
                    <p>Esta sección está en desarrollo</p>
                </div>
            </section>

            <section id="analytics" class="tab-content">
                <div class="page-header">
                    <div class="page-title">
                        <h2>Analytics</h2>
                        <p>Análisis avanzado de datos</p>
                    </div>
                </div>
                <div class="coming-soon">
                    <i data-lucide="construction"></i>
                    <h3>Próximamente</h3>
                    <p>Esta sección está en desarrollo</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Notification Container -->
    <div id="notifications-container" class="notifications-container"></div>

    <!-- Modal Container -->
    <div id="modal-container" class="modal-container"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- App Scripts -->
    <script type="module" src="/js/main.js"></script>
</body>
</html>